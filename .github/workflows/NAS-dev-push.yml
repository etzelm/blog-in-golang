name: NAS-dev-push
# This workflow deploys develop branch blog changes to my NAS
on:
  push:
    branches:
      - 'develop'
  pull_request:
  workflow_dispatch:

jobs:

  build:
    runs-on: [self-hosted, Linux, X64, nas]
    env:
        NAS_ADDR: ${{ secrets.NAS_ADDR }}
        NAS_USER: ${{ secrets.NAS_USER }}
        NAS_PASS: ${{ secrets.NAS_PASS }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Build
        shell: bash
        run: |
          echo STARTING BUILD
          BRANCH=${GITHUB_HEAD_REF:-${GITHUB_REF#refs/heads/}}"
          echo "BRANCH: $BRANCH"
          if [[ $BRANCH -eq "master" ]]; then TAG="latest"; else TAG="$BRANCH"; fi
          echo "TAG: $TAG"
          pushd realtor
          npm install
          yarn build
          popd
          docker build -t blog:$TAG .
          docker system prune -f